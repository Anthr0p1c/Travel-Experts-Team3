//
  David Grant
  2021/07/13
  CPRG-008
  Assignment 4 - Day 8-18


// Layout for all pages. Banner and menu at top of pages.
doctype html
head

  meta(charset='UTF-8')
  meta(http-equiv='X-UA-Compatible' content='IE=edge')
  meta(name='viewport' content='width=device-width, initial-scale=1.0')
  link(rel='stylesheet' href='/stylesheets/style.css')
  //- script(type='text/javascript' src='/javascripts/regex.js')
  title Travel Experts






    







  .sticky
    
    .header
      img(src='/images/banner.jpg' width='100%' height='300px')
      .left
        img(src='/images/logo.png' width='50%' height='auto')
      // Top right links for register and sign in
      .register

        if currentUser
          span Welcome  #{currentUser.username} 
          a(href="/log-out") Log Out 
        else 
          a(href='#' onclick='displayRegisterForm()') Register
          a(href="#" onclick='displayForm()') Sign in
      // Bottom left links on banner
      .tabs
        //a(href='packages.html') Vacation Packages        
        a(href='/travel_packages') Vacation Packages
        a(href='hotels.html') Hotels
        a(href='offers.html') Special Offers
        a(href='/contact/createcontact') Contact
        a(href="/about") About Us
        //a(href="/travel_packages") Travel 
        
        if currentUser && currentUser.role == "Senior Agent"
         a(href="/update/showdashboard") Agent DashBoard
         
       
        if currentUser && currentUser.role == "manager"
         a(href='/update/data') Manager DashBoard
      // Drop down hamburger menu if the screen is less than 600px wide
      .dropdownright
        .dropdown
          button.dropbtn
            .menu
            .menu
            .menu
          .dropdown-content
            a(href='#' onclick='displayRegisterForm()') Register
            a(href="#" onclick='displayForm()') Sign in
            a(href='packages.html') Vacation Packages
            a(href='hotels.html') Hotels
            a(href='offers.html') Special Offers
            a(href='contact.html') Contact
    // End of banner/nav menu

body




  // Login form
  <div class="form-popup" id="myForm">
    <form action="/login" class="form-container" method="POST">
      <h2>Sign in</h2>
      <div class="flex">
        <label for="username"><b>Email:</b></label>
        <input type="text" placeholder="Enter Email" name="username" required>

        <label for="password"><b>Password:</b></label>
        <input type="password" placeholder="Enter Password" name="password" required>
      </div>

      <div class="flex">
        <button type="submit" class="btn">Sign in</button>
        <button type="submit" class="btn cancel" onclick="closeForm()">Close</button>
      </div>
    </form>
  </div>




  // Register form
  <div class="form-popup" id="myRegisterForm">
    // On form submit call verification function
    <form action='/' class="form-container-register" onSubmit="Validate()" method='POST'>
      
      .row
        .leftTable
          label(for='email') Email:
        .centerTable
          input#email.form-control(type='text' name='email' placeholder='Email' onfocus="displayText('email')")
      .row
        .leftTable
          label(for='password') Password:
        .centerTable
          input#password.form-control(type='password' name='password' placeholder='Password' onfocus="displayText('password')")
      .row
        .leftTable
          label(for='fname') First Name:
        .centerTable
          input#fname.form-control(type='text' name='fname' placeholder='First name')
      .row
        .leftTable
          label(for='lname') Last Name:
        .centerTable
          input#lname.form-control(type='text' name='lname' placeholder='Last name')
      .row
        .leftTable
          label(for='phone') Phone Number:
        .centerTable
          input#lname.form-control(type='text' name='phone' placeholder='Phone')
      .row
        .leftTable
          label(for='address') Address:
        .centerTable
          input#address.form-control(type='text' name='address' placeholder='Address')
      .row
        .leftTable
          label(for='postal') Postal code:
        .centerTable
          input#postal.form-control(type='text' name='postal' placeholder='Postal code')
      .row
        .leftTable
          label(for='city') City:
        .centerTable
          input#postal.form-control(type='text' name='city' placeholder='City')
      .row
        .leftTable
          label(for='province') Province:
        // Dropdown for provinces
        .centerTable
          select#province.form-control(name='province')
            option(value='AB') AB
            option(value='BC') BC
            option(value='MB') MB
            option(value='NB') NB
            option(value='NL') NL
            option(value='NT') NT
            option(value='NS') NS
            option(value='NU') NU
            option(value='ON') ON
      .row
        .leftTable
          label(for='country') Country:
        // Dropdown for countries
        .centerTable
          select#country.form-control(name='country')
            option(value='canada') Canada
            option(value='australia') Australia
            option(value='usa') USA

      // Display errors if form fields not correct      
      .row
        h1(id="errors")
              
        <button type="button" class="btn cancel" onclick="closeRegisterForm()">Close</button>
        <button type="submit" class="btn">Register</button>
      </form>
    </div>

      // Form display
  script.
    // Login form
    function displayForm() {
      document.getElementById("myForm").style.display = "block";
    }
    function closeForm() {
      document.getElementById("myForm").style.display = "none";
    }
    // Register form
    function displayRegisterForm() {
      document.getElementById("myRegisterForm").style.display = "block";
    }
    function closeRegisterForm() {
      document.getElementById("myRegisterForm").style.display = "none";
    }
    document.getElementById("userName").innerHTML(currentUser)

    function Validate() {
      
      emailD=document.getElementById("email").value
      passwordD=document.getElementById("password").value
      fnameD=document.getElementById("fname").value
      lnameD=document.getElementById("lname").value
      addressD=document.getElementById("address").value
      postalD=document.getElementById("postal").value
      provinceD=document.getElementById("province").value
      countryD=document.getElementById("country").value
      phoneD=document.getElementById("phone").value
      cityD=document.getElementById("city").value

      var formData = {
          email:emailD,
          password:passwordD,
          fname:fnameD,
          lname:lnameD,
          address:addressD,
          postal:postalD,
          province:provinceD,
          country:countryD,
          city:cityD,
          phone:phoneD
      }
      

      regexEmail = /^[^\\s@]+@[^\s@]+\.[^\s@]+$/
      regexPassword = /^(?=.*[!@#$%^&*])(?=.*[A-Z])(?=.*[a-z])/
      regexAddress = /^\s*\S+(?:\s+\S+){2}/
      regexPostal = /^[ABCEGHJ-NPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][ -]?\d[ABCEGHJ-NPRSTV-Z]\d$/

      returnString = ""
      for (x in formData) {
          if (formData[x].length < 1) {
              returnString = "All elements must be filled out."
          }
      }

      if (regexEmail.test(formData["email"])==false){
        returnString = "Must use a valid email address."
      }
      else if (regexPassword.test(formData["password"])==false){
        returnString = "Must use a valid email address."
      }
      else if (regexAddress.test(formData["address"])==false){
        returnString = "Must use a valid email address."
      }
      else if (regexPostal.test(formData["postal"])==false){
        returnString = "Must use a valid email address."
      }
      

      if (returnString != "") {
        document.getElementById("errors").innerHTML = returnString
      }
      else {
        document.getElementById("errors").innerHTML = "Thank you for registering!"
      }
      
    }
    
block content 